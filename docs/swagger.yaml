openapi: 3.0.0
info:
  title: Contact Management API
  version: 1.0.0
  description: API untuk manajemen kontak, user, dan alamat

servers:
  - url: http://localhost:8080
    description: Local development server

tags:
  - name: Auth
    description: Authentication endpoints
  - name: Users
    description: User management endpoints
  - name: Contacts
    description: Contact management endpoints
  - name: Addresses
    description: Address management endpoints

paths:
  # ==================== AUTH ====================
  /login:
    post:
      summary: User login
      description: Authenticate user and get access token
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Login successful"
                  user:
                    type: object
                    properties:
                      user_id:
                        type: integer
                        example: 1
                      email:
                        type: string
                        example: "dio@example.com"
                      token:
                        type: string
                        example: "767e5374-c993-44ae-8f62-bf09c042044b"
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          description: Invalid email or password
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ==================== USERS ====================
  /user:
    post:
      summary: Create new user
      description: Register a new user account
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User created successfully"
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalError'

    get:
      summary: Get all users
      description: Retrieve list of all users
      tags:
        - Users
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Success"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /user/{id}:
    get:
      summary: Get user by ID
      description: Retrieve a specific user by their ID
      tags:
        - Users
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Success"
                  data:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    put:
      summary: Update user
      description: Update an existing user by ID
      tags:
        - Users
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/UserId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User updated successfully"
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # ==================== CONTACTS ====================
  /contact:
    post:
      summary: Create new contact
      description: Create a new contact for the authenticated user
      tags:
        - Contacts
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateContactRequest'
      responses:
        '201':
          description: Contact created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Contact created successfully"
                  data:
                    $ref: '#/components/schemas/Contact'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

    get:
      summary: Get all contacts
      description: Retrieve all contacts for the authenticated user
      tags:
        - Contacts
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Success"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Contact'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /contact/{id}:
    get:
      summary: Get contact by ID
      description: Retrieve a specific contact by ID
      tags:
        - Contacts
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ContactId'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Success"
                  data:
                    $ref: '#/components/schemas/Contact'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    put:
      summary: Update contact
      description: Update an existing contact by ID
      tags:
        - Contacts
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ContactId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateContactRequest'
      responses:
        '200':
          description: Contact updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Contact updated successfully"
                  data:
                    $ref: '#/components/schemas/ContactData'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    delete:
      summary: Delete contact
      description: Delete a contact by ID
      tags:
        - Contacts
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ContactId'
      responses:
        '200':
          description: Contact deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Contact deleted successfully"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # ==================== ADDRESSES ====================
  /address/:
    post:
      summary: Create new address
      description: Create a new address for a contact
      tags:
        - Addresses
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAddressRequest'
      responses:
        '201':
          description: Address created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Address created successfully"
                  data:
                    $ref: '#/components/schemas/AddressData'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Contact not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalError'

  /address/{contactId}:
    get:
      summary: Get all addresses for a contact
      description: Retrieve all addresses for a specific contact
      tags:
        - Addresses
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ContactIdPath'
      responses:
        '200':
          description: Addresses retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Addresses retrieved successfully"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Address'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Contact not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalError'

  /address/{contactId}/{addressId}:
    get:
      summary: Get address by ID
      description: Retrieve a specific address by ID
      tags:
        - Addresses
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ContactIdPath'
        - $ref: '#/components/parameters/AddressId'
      responses:
        '200':
          description: Address retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Address retrieved successfully"
                  data:
                    $ref: '#/components/schemas/Address'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    put:
      summary: Update address
      description: Update an existing address by ID
      tags:
        - Addresses
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ContactIdPath'
        - $ref: '#/components/parameters/AddressId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAddressRequest'
      responses:
        '200':
          description: Address updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Address updated successfully"
                  data:
                    $ref: '#/components/schemas/AddressData'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    delete:
      summary: Delete address
      description: Delete an address by ID
      tags:
        - Addresses
      security:
        - ApiKeyAuth: []
      parameters:
        - $ref: '#/components/parameters/ContactIdPath'
        - $ref: '#/components/parameters/AddressId'
      responses:
        '200':
          description: Address deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Address deleted successfully"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: Authorization
      description: Token yang didapat dari endpoint /login

  parameters:
    UserId:
      name: id
      in: path
      required: true
      description: User ID
      schema:
        type: integer
        example: 1

    ContactId:
      name: id
      in: path
      required: true
      description: Contact ID
      schema:
        type: integer
        example: 1

    ContactIdPath:
      name: contactId
      in: path
      required: true
      description: Contact ID
      schema:
        type: integer
        example: 1

    AddressId:
      name: addressId
      in: path
      required: true
      description: Address ID
      schema:
        type: integer
        example: 1

  responses:
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            type: object
            properties:
              errors:
                type: array
                items:
                  type: string
                example: ["Name is required", "Email is email"]

    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Unauthorized"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Not found"

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Internal Server Error"

  schemas:
    # ==================== REQUEST SCHEMAS ====================
    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "dio@example.com"
        password:
          type: string
          format: password
          example: "password123"

    CreateUserRequest:
      type: object
      required:
        - name
        - email
        - password
      properties:
        name:
          type: string
          example: "Dio Saputra"
        email:
          type: string
          format: email
          example: "dio@example.com"
        password:
          type: string
          format: password
          example: "password123"

    UpdateUserRequest:
      type: object
      required:
        - name
        - email
        - password
      properties:
        name:
          type: string
          example: "Dio Updated"
        email:
          type: string
          format: email
          example: "dio.updated@example.com"
        password:
          type: string
          format: password
          example: "newpassword123"

    CreateContactRequest:
      type: object
      required:
        - first_name
        - last_name
        - email
        - phone
      properties:
        first_name:
          type: string
          example: "John"
        last_name:
          type: string
          example: "Doe"
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        phone:
          type: string
          example: "081234567890"

    UpdateContactRequest:
      type: object
      required:
        - first_name
        - last_name
        - email
        - phone
      properties:
        first_name:
          type: string
          example: "John"
        last_name:
          type: string
          example: "Doe"
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        phone:
          type: string
          example: "081234567890"

    CreateAddressRequest:
      type: object
      required:
        - country
        - contact_id
      properties:
        street:
          type: string
          example: "Jl. Merdeka No. 10"
        city:
          type: string
          example: "Jakarta"
        province:
          type: string
          example: "DKI Jakarta"
        country:
          type: string
          example: "Indonesia"
        postal_code:
          type: string
          example: "12345"
        contact_id:
          type: string
          example: "1"

    UpdateAddressRequest:
      type: object
      required:
        - country
      properties:
        street:
          type: string
          example: "Jl. Merdeka No. 10"
        city:
          type: string
          example: "Jakarta"
        province:
          type: string
          example: "DKI Jakarta"
        country:
          type: string
          example: "Indonesia"
        postal_code:
          type: string
          example: "12345"

    # ==================== RESPONSE SCHEMAS ====================
    User:
      type: object
      properties:
        user_id:
          type: integer
          example: 1
        name:
          type: string
          example: "Dio Saputra"
        email:
          type: string
          format: email
          example: "dio@example.com"
        created_at:
          type: string
          format: date-time
          nullable: true
          example: "2024-01-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          nullable: true
          example: "2024-01-15T10:30:00Z"

    Contact:
      type: object
      properties:
        contact_id:
          type: string
          example: "1"
        first_name:
          type: string
          example: "John"
        last_name:
          type: string
          example: "Doe"
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        phone:
          type: string
          example: "081234567890"
        user_id:
          type: string
          example: "1"
        created_at:
          type: string
          format: date-time
          nullable: true
        updated_at:
          type: string
          format: date-time
          nullable: true

    ContactData:
      type: object
      properties:
        first_name:
          type: string
          example: "John"
        last_name:
          type: string
          example: "Doe"
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        phone:
          type: string
          example: "081234567890"

    Address:
      type: object
      properties:
        address_id:
          type: string
          example: "1"
        street:
          type: string
          example: "Jl. Merdeka No. 10"
        city:
          type: string
          example: "Jakarta"
        province:
          type: string
          example: "DKI Jakarta"
        country:
          type: string
          example: "Indonesia"
        postal_code:
          type: string
          example: "12345"
        contact_id:
          type: string
          example: "1"
        created_at:
          type: string
          format: date-time
          nullable: true
        updated_at:
          type: string
          format: date-time
          nullable: true

    AddressData:
      type: object
      properties:
        street:
          type: string
          example: "Jl. Merdeka No. 10"
        city:
          type: string
          example: "Jakarta"
        province:
          type: string
          example: "DKI Jakarta"
        country:
          type: string
          example: "Indonesia"
        postal_code:
          type: string
          example: "12345"

    Error:
      type: object
      properties:
        message:
          type: string
          example: "Error message"
